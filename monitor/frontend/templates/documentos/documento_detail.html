{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
        <div class="card shadow-sm mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">{{ documento.titulo }}</h4>
                <span class="badge bg-{% if documento.processado %}success{% else %}warning text-dark{% endif %}">
                    {% if documento.processado %}Processado{% else %}Pendente{% endif %}
                </span>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong>Data de Publicação:</strong> {{ documento.data_publicacao|date:"d/m/Y" }}
                </div>
                <div class="mb-2">
                    <strong>Arquivo PDF:</strong>
                    {% if documento.arquivo_pdf %}
                        <a href="{{ documento.arquivo_pdf.url }}" target="_blank" class="btn btn-sm btn-outline-primary ms-2"><i class="bi bi-file-earmark-pdf"></i> Visualizar</a>
                        <a href="{{ documento.arquivo_pdf.url }}" download class="btn btn-sm btn-outline-success ms-2"><i class="bi bi-download"></i> Baixar</a>
                    {% else %}
                        <span class="text-muted">Não disponível</span>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <strong>Resumo:</strong>
                    <div class="alert alert-info mt-2" role="alert">
                        {{ documento.resumo|default:"(sem resumo disponível)" }}
                    </div>
                </div>
                <div class="mb-4">
                    <h5>Normas Relacionadas</h5>
                    <ul class="list-group">
                        {% for norma in documento.normas_relacionadas.all %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a href="{% url 'norma_historico' norma.id %}">{{ norma.tipo }} {{ norma.numero }}</a>
                            <span class="badge bg-{% if norma.situacao == 'VIGENTE' %}success{% else %}danger{% endif %}">
                                {{ norma.get_situacao_display }}
                            </span>
                        </li>
                        {% empty %}
                        <li class="list-group-item">Nenhuma norma relacionada</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="d-flex justify-content-between">
                    <a href="{% url 'analise_documentos' %}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Voltar</a>
                    {% if not documento.processado %}
                        <form method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" name="processar" class="btn btn-warning">
                                <i class="bi bi-arrow-clockwise"></i> Processar Documento
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}