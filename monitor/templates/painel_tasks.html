<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle de Tasks</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
        .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 32px 24px; }
        h2 { color: #2c3e50; margin-bottom: 18px; }
        .actions { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        .actions button { background: #3498db; color: #fff; border: none; padding: 10px 18px; border-radius: 4px; font-size: 1em; cursor: pointer; transition: background 0.2s; }
        .actions button:hover { background: #217dbb; }
        .status-box { background: #f1f1f1; border-radius: 4px; padding: 12px; margin-top: 10px; font-size: 1em; }
        .result { font-size: 0.95em; color: #222; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Painel de Controle de Tasks Celery</h2>
        <div class="actions">
            <button onclick="dispararTask('coletar_diario')">Coletar Diário Oficial</button>
            <button onclick="dispararTask('processar_documentos')">Processar Documentos Pendentes</button>
            <button onclick="dispararTask('processar_documentos_especificos')">Processar Documentos Específicos</button>
            <button onclick="dispararTask('verificar_normas')">Verificar Normas SEFAZ</button>
            <button onclick="dispararTask('verificar_normas_especificas')">Verificar Normas Específicas SEFAZ</button>
            <button onclick="dispararTask('coletar_dados_receita')">Coletar Dados Receita Federal</button>
            <button onclick="dispararTask('coletar_todos_os_documentos')">Coletar Todos os Documentos (Diário)</button>
            <button onclick="dispararTask('gerar_relatorio')">Gerar Relatório</button>
            <button onclick="dispararTask('pipeline_manual')">Pipeline Manual</button>
            <button onclick="dispararTask('pipeline_automatica')">Pipeline Automática</button>
        </div>
        <div id="status" class="status-box"></div>
        <a href="{% url 'home' %}" style="color:#3498db;">&larr; Voltar</a>
    </div>
    <script>
        function dispararTask(tipo) {
            document.getElementById('status').innerHTML = 'Disparando task...';
            fetch('/painel-tasks/', {
                method: 'POST',
                headers: {'X-CSRFToken': '{{ csrf_token }}', 'Content-Type': 'application/json'},
                body: JSON.stringify({tipo: tipo})
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById('status').innerHTML = '<b>Status:</b> ' + (data.status || 'OK') + '<div class="result">' + (data.result || '') + '</div>';
            })
            .catch(() => {
                document.getElementById('status').innerHTML = 'Erro ao disparar task.';
            });
        }
    </script>
</body>
</html>
